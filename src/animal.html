<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main pages</title>
    <script src="../node_modules/axios/dist/axios.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animal.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="demo.css">
    <script src="../node_modules/gridstack/dist/gridstack-all.js"></script>

</head>

<body>
    <header class="header">
        <nav class="main-nav-bar">
            <div class="main-nav-item" id="monitor">Мониторинг</div>
            <div class="main-nav-item" id="animals">Животные</div>
            <div class="main-nav-item" id="equipments">Оборудование</div>
        </nav>
        <div class="side-header-bar">
            <div class="side-header-item" id="header-search"></div>
            <div class="side-header-item" id="burger-menu">
                <span class="burger-line"></span>
                <span class="burger-line"></span>
                <span class="burger-line"></span>
            </div>
            <div class="burger-nav">
                <div class="logout" id="logout">
                    <div class="logoutIcon"></div>
                    <div class="logoutTitle">Выход</div>
                </div>
                <div class="settings" id="burger-settings">
                    <div class="burgerSettingsIcon"></div>
                    <div class="logoutTitle">Параметры</div>
                </div>
            </div>
        </div>
        <div class="widget-logo"></div>
    </header>
    <div class="page" id="page">
        <div class="animals-memu" id="animals-memu">
            <ul id="animals-menu-list">
                <li>
                    <div id="review" class="animals-menu-item active-animal-item">
                        <img width="30" height="30" src="./svg/Group.svg" class="img-margin">
                        <span>Обзор</span></img>
                        <button class="button"></button>
                    </div>
                    <ul>
                        <li>Карторчка животного</a></li>
                        <li>Отчет 1</a></li>
                        <li>Создать Отчет</a></li>
                    </ul>
                </li>
                <li>
                    <div id="yeald" class="animals-menu-item">
                        <img width="30" height="30" src="./svg/Yeld.svg" class="img-margin">Доение</img>
                        <button class=button></button>
                    </div>
                    <ul>
                        <li>Отчет 1</a></li>
                        <li>Отчет 2</a></li>
                        <li>Отчет 3</a></li>
                    </ul>
                </li>
                <li>
                    <div id="food" class="animals-menu-item">
                        <img width="30" height="30" src="./svg/Eat.svg" class="img-margin">Кормление</img>
                        <button class=button></button>
                    </div>
                    <ul>
                        <li>Отчет 1</a></li>
                        <li>Отчет 2</a></li>
                        <li>Отчет 3</a></li>
                        <li style="font-weight: 700">Параметры</li>
                    </ul>
                </li>
                <li>
                    <div id="sort" class="animals-menu-item">
                        <img width="30" height="30" src="./svg/Sort.svg" class="img-margin">Сортировка</img>
                        <button class=button></button>
                    </div>
                    <ul>
                        <li>Отчет 1</a></li>
                        <li>Отчет 2</a></li>
                        <li>Отчет 3</a></li>
                    </ul>
                </li>
                <li>
                    <div id="bull" class="animals-menu-item">
                        <img width="30" height="30" src="./svg/bull.svg" class="img-margin">Воспроизводство</img>
                        <button class=button></button>
                    </div>
                    <ul>
                        <li>Отчет 1</a></li>
                        <li>Отчет 2</a></li>
                        <li>Отчет 3</a></li>
                    </ul>
                </li>
                <li>
                    <div id="health" class="animals-menu-item">
                        <img width="30" height="30" src="./svg/Health.svg" class="img-margin">Здоровье</img>
                        <button class=button></button>
                    </div>
                    <ul>
                        <li>Отчет 1</a></li>
                        <li>Отчет 2</a></li>
                        <li>Отчет 3</a></li>
                    </ul>
                </li>
                <li>
                    <div id="info" class="animals-menu-item">
                        <img width="30" height="30" src="./svg/info.svg" class="img-margin">Уведомления</img>
                        <button class=button></button>
                    </div>
                    <ul>
                        <li>Отчет 1</a></li>
                        <li>Отчет 2</a></li>
                        <li>Отчет 3</a></li>
                    </ul>
                </li>
            </ul>

        </div>
        <div class="aminals-main-field" id="animals-main-field">
            <div class="animal-container animals-page-active" id="review-page">
                <div class="animals-review">
                    <div class="animals-review-title">
                        <span>Обзор</span>
                        <button class="add-cow-button"></button>
                        <button class="all-field-button"></button>
                    </div>
                </div>
            </div>
            <div class="animal-container" id="yeald-page">
                <div class="animals-review">
                    <div class="animals-review-title">
                        <span>Доение</span>
                    </div>
                </div>
            </div>
            <div class="animal-container" id="food-page">
                <div class="animals-food">
                    <div class="animals-food-title">
                        <span>Параметры кормления по стаду</span>
                        <button class="save-food-setting"></button>
                    </div>
                    <div class="food-setting-container">
                        <div class="food-setting">
                            <div class="food-setting-item">
                                <div class="food-settig-icon single-give"></div>
                                <span style="width: 210px;">Разовая выдача, не более</span>
                                <input class="food-input kg-input" type="number" step="0.1">
                                <span>кг</span>
                            </div>
                            <div class="food-setting-item">
                                <div class="food-settig-icon single-give-24"></div>
                                <span style="width: 210px;">Суточная выдача, не более</span>
                                <input class="food-input kg-input" type="number" step="0.1">
                                <span>кг</span>
                            </div>
                        </div>
                        <div class="food-setting">
                            <div class="food-setting-item">
                                <div class="food-settig-icon max-green"></div>
                                <span style="width: 330px;">Увеличение суточного рациона, не более</span>
                                <input class="food-input kg-input" type="number" step="0.1">
                                <span>кг</span>
                            </div>
                            <div class="food-setting-item">
                                <div class="food-settig-icon max-red"></div>
                                <span style="width: 330px;">Уменьшение суточного рациона, не более</span>
                                <input class="food-input kg-input" type="number" step="0.1">
                                <span>кг</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="animals-food">
                    <div class="animals-food-title">
                        <span>Расчет количества корма</span>
                    </div>

                    <div class="food-settings-calculate">
                        <div class="food-settings-configs">
                            <div class="settings-configs-item food-fixed food-config-active">Фиксированный</div>
                            <div class="settings-configs-item food-target">Целеой</div>
                            <div class="settings-configs-item food-combo">Комбинированный</div>
                        </div>
                        <div class="food-setting-container">
                            <div class="food-setting">
                                <div class="food-setting-item">
                                    <div class="food-settig-icon single-24"></div>
                                    <span>Суточная выдача</span>
                                    <input class="food-input kg-input" type="number" step="0.1">
                                    <span>кг</span>
                                </div>
                            </div>
                            <div class="food-setting">
                                <div class="food-setting-item">
                                    <div class="food-settig-icon time-add "></div>
                                    <span>Временная прибавка</span>
                                    <input class="food-input kg-input" type="number" step="0.1">
                                    <span>кг на</span>
                                    <input class="food-input" type="number" step="0.1">
                                    <span>дней</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="animals-food">
                    <div class="animals-food-title">
                        <span>Распределение корма</span>

                    </div>
                    <div class="food-setting-container">
                        <div class="food-setting">
                            <div class="food-setting-item">
                                <div class="food-settig-icon min-one-day"></div>
                                <span style="width:240px;">Минимальная выдача, не более</span>
                                <input class="food-input" type="number" step="0.1">
                                <span>% от суточного рациона</span>
                            </div>
                            <div class="food-setting-item">
                                <div class="food-settig-icon max-one-day"></div>
                                <span style="width:240px;">Максимальная выдача корма</span>
                                <input class="food-input" type="number" step="0.1">
                                <span>% от суточного рациона</span>
                            </div>
                        </div>
                        <div class="food-setting">
                            <div class="food-setting-item">
                                <div class="food-settig-icon time-to-eat"></div>
                                <span>Скорость поедания</span>
                                <input class="food-input" min="0" type="number" step="0.1">
                                <span>гр/сек</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="animal-container" id="sort-page">
                <div class="animals-review">
                    <div class="animals-review-title">
                        <span>Сортировка</span>
                    </div>
                </div>
            </div>
            <div class="animal-container" id="bull-page">
                <div class="animals-review">
                    <div class="animals-review-title">
                        <span>Воспроизводство</span>
                    </div>
                </div>
            </div>
            <div class="animal-container" id="health-page">
                <div class="animals-review">
                    <div class="animals-review-title">
                        <span>Здоровье</span>
                    </div>
                </div>
            </div>
            <div class="animal-container" id="info-page">
                <div class="animals-review">
                    <div class="animals-review-title">
                        <span>Уведомления</span>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="js/main.js"></script>
    <script>
        //Указываем по нажатию на какой элемент должны открыватся подменю
        $("#animals-menu-list li .animals-menu-item").click(function () {
            console.log(22)
            if (false == $(this).closest(".animals-menu-item").next().is(':visible')) {
                $('#animals-menu-list ul').slideUp(350);
                $("#animals-menu-list .button").removeClass("button-active");
                $(".animals-menu-item").removeClass("active-animal-item");

                const animalsMenuId = $(this).closest(".animals-menu-item").attr("id");
                $(".animal-container").removeClass("animals-page-active")
                $(`#${animalsMenuId}-page`).addClass("animals-page-active")
                console.log($(`#${animalsMenuId}-page`))
            }
            $(this).closest(".animals-menu-item").next().slideToggle(350);
            $(this).children(".button").toggleClass("button-active");
            $(this).closest(".animals-menu-item").toggleClass("active-animal-item")
        });

        $("#review-page").on("click", ".field-button", function () {
            console.log(22)
            if (false == $(this).closest(".animals-review-title").next().is(':visible')) {
                $('.group-container').slideUp(350);
                $(".review-container .field-button").removeClass("button-active");
            }
            $(this).closest(".animals-review-title").next().slideToggle(350);
            $(this).closest(".field-button").toggleClass("button-active");
        });

        $("#review-page").on("click", ".all-field-button", function () {
            if ($(this).closest(".all-field-button").hasClass("button-active")) {
                $('.group-container').slideUp(350);
                $(this).closest(".all-field-button").removeClass("button-active");
                $(".field-button").removeClass("button-active")
            } else {
                $('.group-container').slideDown(350);
                $(this).closest(".all-field-button").addClass("button-active");
                $(".field-button").addClass("button-active")
            }

        })
        $(".kg-input").change(function () {
            const foodValue = ($(this).closest(".kg-input").val())
            const foodValueFixed = Number(foodValue).toFixed(1)
            $(this).closest(".kg-input").val(foodValueFixed)
        })

        $("#monitor").click(function () {
            location.href = "http://127.0.0.1:5502/src/main.html"
        })

        class Group {
            constructor(title) {
                this.title = title;
            }
        }

        let cowGroups = [new Group("Дойные"), new Group("Нетели"), new Group("Быки"), new Group("Другие"),]
        let groupList = $(`#review-page`);

        function populateGroups(currentGroups, groupsView, index) {
            groupsView.find(".animals-review-item").each(function () {
                $(this).remove()
            })
            $.each(currentGroups, function (index, value) {
                const card = `
                
                    <div class="animals-review-title">
                        <div class="animals-review-main">
                            <span>${value["title"]}</span>
                            <div class="value" id="flockValue${index}"></div>
                            <dic class="problem-value"></dic>
                        </div>
                        <button class="edit-group"></button>
                        <button class="field-button"></button>
                    </div>
                    <div class="group-container">
                        <ul class="cow-list" id="flock${index}">

                        </ul>
                    </div>
                
`
                const element = document.createElement('div');
                element.innerHTML = card;
                groupsView.append(element);
                element.classList.add("animals-review-item")
                console.log("Создали Элемент")
            })
            groupsView.append(`<div class="animals-review-add animals-review-item">
                    <div class="animals-review-title">
                        <div class="animals-review-main-info">
                            <button class="add-group-button"></button>
                            <span style="font-weight: normal;" >Добавить группу</span>
                        </div>
                    </div>
                </div>`)
            console.log("Создали добавление")
            // $(`#flockValue${index}`).text(`${currentHerd.length} животных`)
            // $(`#flockValue${index}`).text(herdView.length)

            // $("#flock0").closest(".animals-review-item").children(".animals-review-title").children(".animals-review-main").children(".value2").text()
        }

        $("#review-page").on("click", ".animals-review-add", function () {

            let title = prompt("Название")
            newGroup = new Group(title)

            cowGroups.push(newGroup);
            populateGroups(Object.values(cowGroups), groupList);
            createCows()
        })

        class Cow {
            constructor(id, type) {
                this.id = id;
                this.type = type;
            };
        }

        let herd = {
            "herd0": [new Cow("1", "Стельная"), new Cow("2", "Стельная",), new Cow("3", "Стельная",)],
            "herd1": [new Cow("1", "НеСтельная"), new Cow("2", "НеСтельная",), new Cow("3", "НеСтельная",), new Cow("5", "НеСтельная",), new Cow("5", "НеСтельная",), new Cow("5", "НеСтельная",), new Cow("5", "НеСтельная",), new Cow("5", "НеСтельная",), new Cow("5", "НеСтельная",)],
            "herd2": [],
            "herd3": [],
            "herd4": [],
        }

        function populateCows(currentHerd, herdView, index) {
            herdView.find(".cow-list-item").each(function () {
                $(this).remove()
            })
            $.each(currentHerd, function (index, value) {
                const card = `
                                <div class="count">${value["id"]}</div>
                                <div class="cow-type">${value["type"]}</div>
`
                const element = document.createElement('li');
                element.innerHTML = card;
                herdView.append(element);
                $(".cow-list").find("li").addClass("cow-list-item")
                console.log(herdView.length)

            })
            herdView.append(`<li class="add-cow-list-item cow-list-item">
                                <div class="add-animal">
                                </div>
                            </li>`)
            $(`#flockValue${index}`).text(`${currentHerd.length} животных`)
            // $(`#flockValue${index}`).text(herdView.length)

            // $("#flock0").closest(".animals-review-item").children(".animals-review-title").children(".animals-review-main").children(".value2").text()
        }

        function createCows() {
            $(".cow-list").each(function (index) {
                let cowList = $(`#flock${index}`);
                console.log(cowList)
                populateCows(Object.values(herd)[index], cowList, index);
                let $current = $(this);

                $current.on("click", ".add-animal", function () {
                    console.log(index)
                    let cowList = $(`#flock${index}`);
                    let id = prompt("Номер")
                    let type = prompt("Тип")
                    newCow = new Cow(id, type)

                    Object.values(herd)[index].push(newCow);
                    populateCows(Object.values(herd)[index], cowList, index);
                })
            })
        }

        populateGroups(Object.values(cowGroups), groupList);
        createCows();

        const inputNumber = $("input[type='number']");
        inputNumber.wrap(`<div class="quantity-number"></div>`);

        $('<button type="button" class="minus-button">-</button>').insertBefore("input[type='number']");
        $('<button type="button" class="plus-button">+</button></div>').insertAfter("input[type='number']");
        const minusButton = $(".minus-button");
        const plusButton = $(".plus-button");

        minusButton.each(function (index) {
            $(this).on("click", function (evt) {
                let inputNumber = $(evt.target).next("input[type='number']");
                inputNumber[0].stepDown();
                inputNumber.change();
            })
        });

        plusButton.each(function (index) {
            $(this).on("click", function (evt) {
                let inputNumber = $(evt.target).prev("input[type='number']");
                inputNumber[0].stepUp();
                inputNumber.change();
            })
        });
    </script>
</body>

</html>